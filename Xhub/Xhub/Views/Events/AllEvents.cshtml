@using Microsoft.AspNet.Identity
@using Xhub.Models
@model IEnumerable<Event>

@{
	ViewBag.Title = "All Events Page";
}

@Html.ValidationSummary()

<ul>
	@foreach (var eVent in Model)
	{
		var userId = User.Identity.GetUserId();

		// Show links for each event if user is logged in
		<li>
			@eVent.EventName - @eVent.DateTime
			
			@if (eVent.IsCanceled)
			{
				<div>Canceled</div>
			}

			@if (eVent.Attendances.Any(a => a.AttendeeId == userId) && !eVent.IsCanceled)
			{
				<div>Attending!</div>
			}
			
			@if (User.Identity.IsAuthenticated)
			{
				// Pass event id to the controller
				<div>
					<a href="@Url.Action("Details", "Events", new {eventId = eVent.Id})">
						Details
					</a>
				</div>
			}
		</li>
	}
</ul>
